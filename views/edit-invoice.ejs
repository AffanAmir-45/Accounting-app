<!DOCTYPE html>
<html>
<head>
  <title>Edit Invoice - SAFFAZ & CO</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
  <h2 class="mb-4">✏️ Edit Invoice #<%= invoice_number %></h2>

  <form method="POST" action="/admin/invoice/<%= invoice_number %>/edit">
    <div class="row mb-3">
      <div class="col">
        <label>Date</label>
        <input type="date" name="date" class="form-control" value="<%= date %>" required>
      </div>
      <div class="col">
        <label>Party Name</label>
        <input type="text" name="party_name" class="form-control" value="<%= party_name %>" required>
      </div>
      <div class="col">
        <label>Type</label>
        <select name="type" class="form-select">
          <option value="cash_sale" <%= type === 'cash_sale' ? 'selected' : '' %>>Cash Sale</option>
          <option value="credit_sale" <%= type === 'credit_sale' ? 'selected' : '' %>>Credit Sale</option>
          <option value="cash_purchase" <%= type === 'cash_purchase' ? 'selected' : '' %>>Cash Purchase</option>
          <option value="credit_purchase" <%= type === 'credit_purchase' ? 'selected' : '' %>>Credit Purchase</option>
        </select>
      </div>
    </div>

    <h5>🛒 Items</h5>
    <div id="itemList">
      <% invoiceGroup.forEach((item, i) => { %>
        <div class="row mb-2 item-row">
          <div class="col">
            <input type="text" name="item_name[]" class="form-control" value="<%= item.item_name %>" required>
          </div>
          <div class="col">
            <input type="number" name="quantity[]" class="form-control" step="0.01" value="<%= item.quantity %>" required>
          </div>
          <div class="col">
            <input type="number" name="rate[]" class="form-control" step="0.01" value="<%= item.rate %>" required>
          </div>
          <div class="col">
            <input type="number" name="amount[]" class="form-control" step="0.01" value="<%= item.amount %>" required>
          </div>
          <div class="col-auto">
            <button type="button" class="btn btn-danger btn-sm" onclick="this.parentNode.parentNode.remove()">🗑️</button>
          </div>
        </div>
      <% }) %>
    </div>

    <button type="button" class="btn btn-secondary mb-3" onclick="addItem()">➕ Add Item</button>

    <br>
    <button type="submit" class="btn btn-primary">💾 Save Changes</button>
    <a href="/admin/invoices" class="btn btn-secondary">← Cancel</a>
  </form>

  <script>
    function addItem() {
      const row = document.createElement('div');
      row.className = 'row mb-2 item-row';
      row.innerHTML = `
        <div class="col">
          <input type="text" name="item_name[]" class="form-control" required>
        </div>
        <div class="col">
          <input type="number" name="quantity[]" class="form-control" step="0.01" required>
        </div>
        <div class="col">
          <input type="number" name="rate[]" class="form-control" step="0.01" required>
        </div>
        <div class="col">
          <input type="number" name="amount[]" class="form-control" step="0.01" required>
        </div>
        <div class="col-auto">
          <button type="button" class="btn btn-danger btn-sm" onclick="this.parentNode.parentNode.remove()">🗑️</button>
        </div>
      `;
      document.getElementById('itemList').appendChild(row);
    }
  </script>
</body>
</html>
